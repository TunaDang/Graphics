{"ast":null,"code":"import { AGraphicObject } from \"../graphicobject\";\nimport { Mat4 } from \"../../math\";\nexport class AInstancedGraphicBase extends AGraphicObject {\n  constructor(...args) {\n    super(...args);\n    this._mesh = void 0;\n    this._geometry = void 0;\n    this._material = void 0;\n  }\n  get mesh() {\n    return this._mesh;\n  }\n  /** Get set count */\n  set count(value) {\n    this.mesh.count = value;\n  }\n  get count() {\n    return this.mesh.count;\n  }\n\n  /**\n   * Set the color of the instance in index `index`\n   * @param index\n   * @param color\n   */\n  setColorAt(index, color) {\n    this.mesh.setColorAt(index, color.asThreeJS());\n  }\n\n  /**\n   * Set the transformation matrix of the instance in index `index`\n   * @param index\n   * @param m\n   */\n  setMatrixAt(index, m) {\n    if (m instanceof Mat4) {\n      this.mesh.setMatrixAt(index, m.asThreeJS());\n    } else {\n      this.mesh.setMatrixAt(index, Mat4.From2DMat3(m).asThreeJS());\n    }\n  }\n  setMatrixAndColorAt(index, mat, color, useOpacity = true) {\n    if (useOpacity) {\n      let mat4 = mat.getMat4();\n      mat4.m30 = 1.0 - color.a;\n      this.setMatrixAt(index, mat4);\n      this.setColorAt(index, color);\n    } else {\n      this.setMatrixAt(index, mat);\n      this.setColorAt(index, color);\n    }\n  }\n  dispose() {\n    super.dispose();\n    if (this._geometry) {\n      this._geometry.dispose();\n    }\n    if (this._material) {\n      this._material.dispose();\n    }\n  }\n  setUsage(usage) {\n    // mesh.instanceMatrix.setUsage( THREE.DynamicDrawUsage );\n    this.mesh.instanceMatrix.setUsage(usage);\n  }\n  get geometery() {\n    return this._geometry;\n  }\n  get material() {\n    return this._material;\n  }\n}","map":{"version":3,"names":["AGraphicObject","Mat4","AInstancedGraphicBase","constructor","args","_mesh","_geometry","_material","mesh","count","value","setColorAt","index","color","asThreeJS","setMatrixAt","m","From2DMat3","setMatrixAndColorAt","mat","useOpacity","mat4","getMat4","m30","a","dispose","setUsage","usage","instanceMatrix","geometery","material"],"sources":["/Users/twist/Documents/Books/Fall 2024/Graphics/A1-Intro-To-Graphics-FA2024/src/anigraph/rendering/graphicelements/AInstancedGraphicBase.ts"],"sourcesContent":["import {AGraphicObject} from \"../graphicobject\";\nimport {Color, Mat3, Mat4} from \"../../math\";\n\nexport abstract class AInstancedGraphicBase extends AGraphicObject{\n    protected abstract _mesh:THREE.InstancedMesh;\n    protected abstract _geometry:THREE.BufferGeometry;\n    protected abstract _material:THREE.Material;\n    get mesh(){return this._mesh;}\n    /** Get set count */\n    set count(value:number){this.mesh.count=value;}\n    get count(){\n        return this.mesh.count;\n    }\n\n\n\n\n    /**\n     * Set the color of the instance in index `index`\n     * @param index\n     * @param color\n     */\n    setColorAt(index:number, color:Color){\n        this.mesh.setColorAt(index, color.asThreeJS());\n    }\n\n    /**\n     * Set the transformation matrix of the instance in index `index`\n     * @param index\n     * @param m\n     */\n    setMatrixAt(index:number, m:Mat4|Mat3){\n        if(m instanceof Mat4){\n            this.mesh.setMatrixAt(index, m.asThreeJS());\n        }else{\n            this.mesh.setMatrixAt(index, Mat4.From2DMat3(m).asThreeJS());\n        }\n    }\n\n    setMatrixAndColorAt(index:number, mat:Mat3|Mat4, color:Color, useOpacity:boolean=true){\n        if(useOpacity){\n            let mat4 = mat.getMat4();\n            mat4.m30 = 1.0-color.a;\n            this.setMatrixAt(index, mat4);\n            this.setColorAt(index, color);\n        }else {\n            this.setMatrixAt(index, mat);\n            this.setColorAt(index, color);\n        }\n    }\n\n\n    dispose(){\n        super.dispose();\n        if(this._geometry){\n            this._geometry.dispose();\n        }\n        if(this._material){\n            this._material.dispose();\n        }\n    }\n\n    setUsage(usage:THREE.Usage){\n        // mesh.instanceMatrix.setUsage( THREE.DynamicDrawUsage );\n        this.mesh.instanceMatrix.setUsage( usage );\n    }\n\n    get geometery(){return this._geometry;}\n    get material(){return this._material;}\n}\n"],"mappings":"AAAA,SAAQA,cAAc,QAAO,kBAAkB;AAC/C,SAAqBC,IAAI,QAAO,YAAY;AAE5C,OAAO,MAAeC,qBAAqB,SAASF,cAAc;EAAAG,YAAA,GAAAC,IAAA;IAAA,SAAAA,IAAA;IAAA,KAC3CC,KAAK;IAAA,KACLC,SAAS;IAAA,KACTC,SAAS;EAAA;EAC5B,IAAIC,IAAIA,CAAA,EAAE;IAAC,OAAO,IAAI,CAACH,KAAK;EAAC;EAC7B;EACA,IAAII,KAAKA,CAACC,KAAY,EAAC;IAAC,IAAI,CAACF,IAAI,CAACC,KAAK,GAACC,KAAK;EAAC;EAC9C,IAAID,KAAKA,CAAA,EAAE;IACP,OAAO,IAAI,CAACD,IAAI,CAACC,KAAK;EAC1B;;EAKA;AACJ;AACA;AACA;AACA;EACIE,UAAUA,CAACC,KAAY,EAAEC,KAAW,EAAC;IACjC,IAAI,CAACL,IAAI,CAACG,UAAU,CAACC,KAAK,EAAEC,KAAK,CAACC,SAAS,CAAC,CAAC,CAAC;EAClD;;EAEA;AACJ;AACA;AACA;AACA;EACIC,WAAWA,CAACH,KAAY,EAAEI,CAAW,EAAC;IAClC,IAAGA,CAAC,YAAYf,IAAI,EAAC;MACjB,IAAI,CAACO,IAAI,CAACO,WAAW,CAACH,KAAK,EAAEI,CAAC,CAACF,SAAS,CAAC,CAAC,CAAC;IAC/C,CAAC,MAAI;MACD,IAAI,CAACN,IAAI,CAACO,WAAW,CAACH,KAAK,EAAEX,IAAI,CAACgB,UAAU,CAACD,CAAC,CAAC,CAACF,SAAS,CAAC,CAAC,CAAC;IAChE;EACJ;EAEAI,mBAAmBA,CAACN,KAAY,EAAEO,GAAa,EAAEN,KAAW,EAAEO,UAAkB,GAAC,IAAI,EAAC;IAClF,IAAGA,UAAU,EAAC;MACV,IAAIC,IAAI,GAAGF,GAAG,CAACG,OAAO,CAAC,CAAC;MACxBD,IAAI,CAACE,GAAG,GAAG,GAAG,GAACV,KAAK,CAACW,CAAC;MACtB,IAAI,CAACT,WAAW,CAACH,KAAK,EAAES,IAAI,CAAC;MAC7B,IAAI,CAACV,UAAU,CAACC,KAAK,EAAEC,KAAK,CAAC;IACjC,CAAC,MAAK;MACF,IAAI,CAACE,WAAW,CAACH,KAAK,EAAEO,GAAG,CAAC;MAC5B,IAAI,CAACR,UAAU,CAACC,KAAK,EAAEC,KAAK,CAAC;IACjC;EACJ;EAGAY,OAAOA,CAAA,EAAE;IACL,KAAK,CAACA,OAAO,CAAC,CAAC;IACf,IAAG,IAAI,CAACnB,SAAS,EAAC;MACd,IAAI,CAACA,SAAS,CAACmB,OAAO,CAAC,CAAC;IAC5B;IACA,IAAG,IAAI,CAAClB,SAAS,EAAC;MACd,IAAI,CAACA,SAAS,CAACkB,OAAO,CAAC,CAAC;IAC5B;EACJ;EAEAC,QAAQA,CAACC,KAAiB,EAAC;IACvB;IACA,IAAI,CAACnB,IAAI,CAACoB,cAAc,CAACF,QAAQ,CAAEC,KAAM,CAAC;EAC9C;EAEA,IAAIE,SAASA,CAAA,EAAE;IAAC,OAAO,IAAI,CAACvB,SAAS;EAAC;EACtC,IAAIwB,QAAQA,CAAA,EAAE;IAAC,OAAO,IAAI,CAACvB,SAAS;EAAC;AACzC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}